/**
 * Created by anton.milko on 4/25/16.
 */
var wl = wl || {};
wl.davis = wl.davis || {};
wl.davis.views = wl.davis.views || {};

wl.davis.views.AccountListView = Marionette.ItemView.extend({
  tagName: 'div',
  template: wl.shared.tpl['account-list'],
  ui: {
    'linkItem': 'ul li a:not(.active)',
    'info': '#account-info:not(.active)',
    'cardDetails': '#card-details:not(.active)',
    'subscriptionInfo': '#subscription-info',
    'units': '#account-units:not(.active)',
    'formats': '#account-formats:not(.active)',
    'integrations':'#account-integrations:not(.active)',
    'computerSoft': '#account-computer-soft:not(.active)',
    'legalDocuments': '#legal-documents:not(.active)',
    'messages': '#messages:not(.active)',
    'farmBeats': '#microsoft-farmbeats:not(.active)',
    'logout': '.account-button'
  },
  events: {
    'click @ui.linkItem': 'onClickLinkItem',
    'click @ui.logout': 'logout',
    'click @ui.info': 'showInfo',
    'click @ui.cardDetails': 'showCardDetails',
    'click @ui.subscriptionInfo': 'showPlan',
    'click @ui.units': 'showUnits',
    'click @ui.formats': 'showFormats',
    'click @ui.integrations': 'showIntegrations',
    'click @ui.computerSoft': 'showComputerSoft',
    'click @ui.legalDocuments': 'showLegalDocuments',
    'click @ui.farmBeats': 'showFarmBeats',
    'click @ui.messages': 'showMessages'
  },
  initialize: function() {
    if (!this.model) {
      this.model = new Backbone.Model;
    }
    this.model.set('isGuest', wl.__bootstrap_is_guest);
    this.model.set('deviceUpgradesAllowedCount', 0);
    this.model.set('contrail', wl.__featureFlags.CONTRAIL);
    this.model.set('messages', wl.__featureFlags.USER_MESSAGING);
    wl.app.vent.on('deviceUpgradesAllowedCount:set', function (data) {
      this.model.set('deviceUpgradesAllowedCount', data);
    }.bind(this));
    wl.app.vent.on('messages:show', function () {
      this.ui.linkItem.removeClass('active');
      this.showMessages();
    }.bind(this));
    this.model.bind('change:deviceUpgradesAllowedCount', this.render);
  },
  onRender: function() {
    if (location.hash) {
      if (location.hash.indexOf('messages') !== -1) {
        this.ui.messages.addClass('active');
      }
      if (location.hash.indexOf('card-details') !== -1) {
        this.ui.cardDetails.addClass('active');
        if (!this.paymentRendered) {
          this.showCardDetails();
          this.paymentRendered = true;
        }
      }
    } else if (sessionStorage.getItem("showAccountSoftware") === 'true') {
        sessionStorage.removeItem("showAccountSoftware");
        this.showComputerSoft();
    } else {
        this.ui.info.addClass('active');
    }
  },
  onClickLinkItem: function () {
    this.ui.linkItem.removeClass('active');
    wl.app.mainRegion.$el.closest('#main-body-container').removeClass('fixed-width');
  },
  showPlan: function() {
    wl.app.mainRegion.show(new wl.app.oAccountInfo.planSubscriptionView());
    this.ui.subscriptionInfo.addClass('active');
  },
  showInfo: function() {
    wl.app.mainRegion.show(new wl.app.oAccountInfo.oAccountView());
    this.ui.info.addClass('active');
  },
  showCardDetails: function() {
    wl.app.mainRegion.show(new wl.app.oAccountInfo.oCardDetailsView());
    this.ui.cardDetails.addClass('active');
  },
  showUnits: function() {
    wl.app.mainRegion.show(new wl.app.oAccountInfo.oUnitView());
    this.ui.units.addClass('active');
  },
  showFormats: function() {
    wl.app.mainRegion.show(new wl.app.oAccountInfo.oFormatView());
    this.ui.formats.addClass('active');
  },
  showIntegrations: function() {
    wl.app.mainRegion.show(new wl.app.oAccountIntegrations.LayoutView());
    this.ui.integrations.addClass('active');
  },
  showComputerSoft: function() {
    wl.app.mainRegion.$el.closest('#main-body-container').addClass('fixed-width');
    wl.app.mainRegion.show(new wl.app.oAccountInfo.oComputerSoftView());
    this.ui.computerSoft.addClass('active');
  },
  showLegalDocuments: function () {
    wl.app.mainRegion.show(new wl.app.oAccountInfo.oLegalDocumentsView());
    this.ui.legalDocuments.addClass('active');
  },
  showFarmBeats: function () {
    wl.app.mainRegion.show(new wl.app.oAccountInfo.oFarmBeatsView());
    this.ui.farmBeats.addClass('active');
  },
  showMessages: function () {
    wl.app.mainRegion.show(new wl.app.oAccountMessages.LayoutView());
    this.ui.messages.addClass('active');
  },
  logout: function() {
    window.location.href = '/logout';
  }
});
